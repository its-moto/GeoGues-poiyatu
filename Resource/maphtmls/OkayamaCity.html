<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="GamePlayStyles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="icon" href="../images/logo-pin.png"> <!-- ãƒšãƒ¼ã‚¸ã‚¢ã‚¤ã‚³ãƒ³ -->

    <script src="../maplink/OkayamaCity.js"></script>
    <title>GeoPpoi - å²¡å±±å¸‚</title>
    <div class="map-name">
        å²¡å±±å¸‚
    </div>
</head>
<body>
    <audio loop id="bgm" preload="auto"></audio>
    <audio id="SoundEffect" preload="auto"></audio>

    <iframe id="streetview" src="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

    <div id="NMPZ-overlay"></div>

    <button class="nextRound"id="button" onclick="showRandomStreetView()">Next RoundğŸš©</button>
    <button class="itemIcon" id="button" onclick="openSetting()" style="bottom: 90px;">âš™</button>
    <button class="itemIcon" id="button" onclick="backToStart()">ğŸ³ï¸</button>

    
    <div class="timer" id="timer">
        <h1 id="countdown">00:00</h1>
        <div class="progress-overlay"></div>
    </div>

    <div class="popup-overlay" id="popup">
        <div class="popup-content">
            <h2>è¨­å®š</h2>
            <center><div class="slider-container">
                <label class="slider-label" for="volumeSlider">éŸ³é‡:</label>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.2">
            </div>
            </center>
            <p>BGM</p>
            <label class="toggle-switch">
                <input type="checkbox" id="bgmToggle">
                <span class="slider"></span>
            </label>
            <br>
            <br>
            <button onclick="showAnswer()">show answer</button>
            <hr color="#c7c7c7" width="50%">
            <button class="close-popup-btn" onclick="closeSetting()">ã‚²ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            <button class="goBack" onclick="goBack()">ã‚²ãƒ¼ãƒ ã‚’å‡ºã‚‹</button> <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->
        </div>
    </div>

    <div class="result-overlay" id="resultPopup">
        <div id="distance"><span id="distance-value">0km</span>, <span style="color: #FECD19;"id="point-value">0</span> <span style="color: #FECD19;">/5000 pt</span></div>

        <div id="remap"></div> <!-- Leafletåœ°å›³ã®è¡¨ç¤ºé ˜åŸŸ -->
        
        <div id="nextRound" onclick="showRandomStreetView()">Next Round</div>
    </div>

    <div id="map-container">
        <div id="map"></div> <!-- Leafletåœ°å›³ã®è¡¨ç¤ºé ˜åŸŸ -->
    </div>
    <button class="guess-button" onclick="guess()">guess</button>

    <script src="../src/SingleGamePlay.js"></script>
    <script src="../src/cssanimation.js"></script>

    <script>//settingã®bgmã¨ã‹
        let isMuted = true;

        // åˆæœŸè¨­å®š
        bgm.volume = volumeSlider.value;
        
        toggle.checked = !isMuted; 
        bgm.muted = isMuted;
        toggle.addEventListener("change", () => {
            isMuted = !toggle.checked; // ãƒˆã‚°ãƒ«ã®çŠ¶æ…‹ã‹ã‚‰isMutedã‚’åè»¢
            bgm.muted = isMuted;

            if (!isMuted) {
                bgm.play();
            }
        });

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§éŸ³é‡ã‚’èª¿æ•´
        volumeSlider.addEventListener("input", function() {
            bgm.volume = this.value;

            localStorage.setItem("bgmVolume", JSON.stringify(this.value));
        });
    </script>
</body>
</html>